<section class="container mx-auto px-4 py-8">
  <!-- Breadcrumb -->
  <div class="mb-4">
    <a [routerLink]="buildUrl('/')" class="text-sm text-gray-600 hover:text-rose-600 transition-colors flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
      Voltar para Home
    </a>
  </div>

  <!-- Header com título e dropdown -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
    <div>
      <h1 class="text-3xl font-serif font-bold text-gray-900 mb-1">{{ categoriaNome$ | async }}</h1>
      <p class="text-sm text-gray-600">Mostrando os melhores profissionais para o seu evento.</p>
    </div>
    <div class="mt-4 md:mt-0">
      <select (change)="onSortChange($event)" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-rose-500">
        <option value="relevante">Mais Relevantes</option>
        <option value="rating">Melhor Avaliação</option>
        <option value="nome">Nome A-Z</option>
      </select>
    </div>
  </div>

  <!-- Grid de Fornecedores -->
  <div *ngIf="sortedFornecedores$ | async as fornecedores; else fornecedoresLoading" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
    <div *ngFor="let fornecedor of fornecedores" 
         class="bg-white rounded-lg shadow-sm hover:shadow-lg border border-gray-200 flex flex-col overflow-hidden transition-all duration-300 group relative">
      
      <!-- Favorite Icon -->
      <button class="absolute top-3 right-3 z-10 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-rose-50 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-400 hover:text-rose-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
      </button>

      <!-- Imagem -->
      <div class="relative h-48 overflow-hidden">
        <img [ngSrc]="resolveImage(fornecedor.primaryImage?.url, 'assets/fornecedores/placeholder.jpg')" loading="lazy" decoding="async" width="300" height="220"
             alt="{{fornecedor.nome}}" 
             class="w-full h-full object-cover" />
        <!-- Verified Badge -->
        <span *ngIf="fornecedor.seloFornecedor" class="absolute top-3 left-3 text-[10px] bg-teal-600 text-white px-2 py-1 rounded font-bold shadow-md uppercase flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
          VERIFICADO
        </span>
      </div>

      <!-- Content -->
      <div class="p-4 flex flex-col flex-1">
        <!-- Categoria Badge -->
        <div class="text-[11px] text-rose-600 font-bold uppercase mb-2">{{fornecedor.categoria?.nome || 'FOTOGRAFIA'}}</div>
        
        <!-- Nome -->
        <h3 class="font-serif font-bold text-lg text-gray-900 mb-2">{{fornecedor.nome}}</h3>
        
        <!-- Location -->
        <div class="flex items-center gap-1 text-sm text-gray-600 mb-2" *ngIf="fornecedor.cidade">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 12.414a4 4 0 10-5.657 5.657l4.243 4.243a8 8 0 1111.314-11.314l-4.243 4.243z" /></svg>
          <span class="text-xs">{{fornecedor.cidade}}</span>
        </div>

        <!-- Description Preview -->
        <p class="text-sm text-gray-600 mb-3 line-clamp-2" *ngIf="fornecedor.descricao">{{fornecedor.descricao}}</p>

        <!-- Rating -->
        <div class="flex items-center gap-1 mb-3" *ngIf="fornecedor.rating">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.966a1 1 0 00.95.69h4.175c.969 0 1.371 1.24.588 1.81l-3.38 2.455a1 1 0 00-.364 1.118l1.287 3.966c.3.921-.755 1.688-1.54 1.118l-3.38-2.455a1 1 0 00-1.175 0l-3.38 2.455c-.784.57-1.838-.197-1.539-1.118l1.287-3.966a1 1 0 00-.364-1.118L2.049 9.393c-.783-.57-.38-1.81.588-1.81h4.175a1 1 0 00.95-.69l1.286-3.966z"/></svg>
          <span class="text-sm font-semibold text-gray-900">{{fornecedor.rating}}</span>
          <span class="text-xs text-gray-500">(128)</span>
        </div>

        <!-- Action Button -->
        <div class="mt-auto">
           <a [routerLink]="buildUrl(['fornecedores', fornecedor.slug])" 
             [attr.data-event-category]="'Navigation'"
             [attr.data-event-action]="'Click Ver Perfil - Lista'"
             [attr.data-vendor-id]="fornecedor.id"
             [attr.data-vendor-name]="fornecedor.nome"
             [attr.data-vendor-category]="fornecedor.categoria?.nome"
             class="block w-full px-4 py-2 border border-rose-400 text-rose-600 bg-white rounded-md text-sm font-semibold hover:bg-rose-50 transition-colors text-center">
            Ver Perfil
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<ng-template #fornecedoresLoading>
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
    <div *ngFor="let sk of [1,2,3,4,5,6,7,8]" class="bg-white rounded-lg border border-gray-200 p-4 animate-pulse flex flex-col">
      <div class="h-48 bg-gray-200 rounded mb-3"></div>
      <div class="h-4 bg-gray-200 rounded w-2/3 mb-2"></div>
      <div class="h-3 bg-gray-100 rounded w-1/2 mb-2"></div>
      <div class="h-3 bg-gray-100 rounded w-4/5 mb-4"></div>
      <div class="mt-auto h-8 bg-gray-200 rounded"></div>
    </div>
  </div>
</ng-template>
