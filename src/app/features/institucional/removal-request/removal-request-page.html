<div class="removal-request-page">
  <!-- ============================================
       HEADER
       ============================================ -->
  <header class="page-header">
    <div class="container">
      <h1>
        <span class="icon">üîí</span>
        Solicita√ß√£o de Remo√ß√£o de Dados
      </h1>
      <p class="subtitle">Gerenciar meu Perfil no Guia Noivas Piracicaba</p>
    </div>
  </header>

  <!-- ============================================
       P√ÅGINA DE SUCESSO (P√ìS-SUBMISS√ÉO)
       ============================================ -->
  <div class="success-state" *ngIf="submitted()">
    <div class="container">
      <div class="success-card">
        <div class="success-icon">‚úÖ</div>
        <h2>Solicita√ß√£o Recebida</h2>
        <p class="success-message">
          Nossa equipe de privacidade analisar√° a titularidade da conta em at√©
          <strong>72 horas √∫teis</strong>.
        </p>
        <p class="success-detail">
          Voc√™ receber√° um email de confirma√ß√£o no endere√ßo fornecido assim que a
          solicita√ß√£o for processada.
        </p>
        <button class="btn-primary" (click)="startNewRequest()">
          Fazer Nova Solicita√ß√£o
        </button>
        <a routerLink="/" class="btn-secondary">Voltar ao In√≠cio</a>
      </div>
    </div>
  </div>

  <!-- ============================================
       FORMUL√ÅRIO (ESTADO INICIAL)
       ============================================ -->
  <div class="form-container" *ngIf="!submitted()">
    <div class="container">
      <!-- ALERTA DE FRIC√á√ÉO -->
      <div class="warning-box">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <div class="warning-content">
          <h3>Aten√ß√£o: Esta a√ß√£o possui consequ√™ncias irrevers√≠veis</h3>
          <p>
            Ao remover seu perfil do <strong>Guia Noivas Piracicaba</strong>, sua
            empresa perder√°:
          </p>
          <ul class="warning-list">
            <li>
              <strong>Indexa√ß√£o no Google</strong> conquistada atrav√©s da nossa
              plataforma
            </li>
            <li>
              <strong>Visibilidade online</strong> para noivas da regi√£o de
              Piracicaba
            </li>
            <li>
              <strong>Hist√≥rico de avalia√ß√µes</strong> e depoimentos de clientes
            </li>
            <li>
              <strong>Contato direto</strong> com potenciais clientes que buscam
              seus servi√ßos
            </li>
          </ul>
          <p class="warning-footer">
            ‚ö†Ô∏è <strong>Esta a√ß√£o √© irrevers√≠vel.</strong> Recomendamos que voc√™
            apenas solicite a remo√ß√£o caso tenha encerrado suas atividades ou por
            quest√µes legais/privacidade.
          </p>
        </div>
      </div>

      <!-- PASSO 1: IDENTIFICA√á√ÉO (BUSCA) -->
      <section class="form-section">
        <div class="section-header">
          <span class="step-number">1</span>
          <h2>Identifica√ß√£o da Empresa</h2>
        </div>

        <div class="search-container">
          <label for="vendorSearch" class="form-label">
            Digite o nome da sua empresa
            <span class="required">*</span>
          </label>
          
          <div class="search-input-wrapper">
            <input
              id="vendorSearch"
              type="text"
              class="form-input search-input"
              placeholder="Ex: Confeitaria Sonho de Valsa"
              [value]="searchQuery()"
              (input)="onSearchInput($event)"
              (blur)="closeDropdown()"
              [disabled]="selectedVendor()"
            />
            
            <!-- Spinner de busca -->
            <span class="search-spinner" *ngIf="isSearching()">üîÑ</span>
            
            <!-- Bot√£o limpar -->
            <button
              class="btn-clear"
              *ngIf="selectedVendor()"
              (click)="clearVendor()"
              type="button">
              √ó
            </button>
          </div>

          <p class="form-hint">
            Digite pelo menos 3 caracteres para buscar
          </p>

          <!-- Dropdown de resultados -->
          <div class="search-dropdown" *ngIf="showDropdown() && searchResults().length > 0">
            <button
              type="button"
              class="search-result-item"
              *ngFor="let vendor of searchResults()"
              (click)="selectVendor(vendor)">
              <div class="vendor-info">
                <span class="vendor-name">{{ vendor.nomeFantasia }}</span>
                <span class="vendor-detail" *ngIf="vendor.categoria">
                  {{ vendor.categoria }}
                </span>
              </div>
            </button>
          </div>

          <!-- Nenhum resultado -->
          <div class="no-results" *ngIf="showDropdown() && !isSearching() && searchResults().length === 0 && searchQuery().length >= 3">
            <p>Nenhuma empresa encontrada com este nome.</p>
            <p class="no-results-hint">
              Verifique se digitou corretamente ou tente outra varia√ß√£o do nome.
            </p>
          </div>

          <!-- Empresa selecionada -->
          <div class="selected-vendor" *ngIf="selectedVendor()">
            <div class="vendor-card">
              <div class="vendor-icon">‚úÖ</div>
              <div class="vendor-details">
                <h4>{{ selectedVendor()!.nomeFantasia }}</h4>
                <p *ngIf="selectedVendor()!.categoria">
                  {{ selectedVendor()!.categoria }}
                </p>
              </div>
              <button class="btn-change" (click)="clearVendor()" type="button">
                Trocar
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- PASSO 2: FORMUL√ÅRIO -->
      <section class="form-section" [class.disabled]="!selectedVendor()">
        <div class="section-header">
          <span class="step-number">2</span>
          <h2>Dados da Solicita√ß√£o</h2>
        </div>

        <form [formGroup]="removalForm" (ngSubmit)="onSubmit()">
          <!-- Email do Respons√°vel -->
          <div class="form-group">
            <label for="requesterEmail" class="form-label">
              E-mail do Respons√°vel
              <span class="required">*</span>
            </label>
            <input
              id="requesterEmail"
              type="email"
              class="form-input"
              formControlName="requesterEmail"
              placeholder="contato@suaempresa.com.br"
              [class.error]="isFieldInvalid('requesterEmail')"
            />
            <p class="form-hint">
              Insira o e-mail comercial para validarmos sua identidade
            </p>
            <p class="error-message" *ngIf="isFieldInvalid('requesterEmail')">
              {{ getFieldError('requesterEmail') }}
            </p>
          </div>

          <!-- Motivo -->
          <div class="form-group">
            <label for="reason" class="form-label">
              Motivo da Solicita√ß√£o
              <span class="required">*</span>
            </label>
            <select
              id="reason"
              class="form-select"
              formControlName="reason"
              [class.error]="isFieldInvalid('reason')">
              <option value="">Selecione um motivo</option>
              <option *ngFor="let reason of reasons" [value]="reason">
                {{ getReasonLabel(reason) }}
              </option>
            </select>
            <p class="error-message" *ngIf="isFieldInvalid('reason')">
              {{ getFieldError('reason') }}
            </p>
          </div>

          <!-- Mensagem Adicional -->
          <div class="form-group">
            <label for="description" class="form-label">
              Mensagem Adicional
              <span class="optional">(Opcional)</span>
            </label>
            <textarea
              id="description"
              class="form-textarea"
              formControlName="description"
              rows="4"
              placeholder="Descreva brevemente o motivo da solicita√ß√£o..."
              maxlength="1000"
            ></textarea>
            <p class="form-hint">
              M√°ximo de 1000 caracteres
            </p>
          </div>

          <!-- Checkbox de Consentimento Legal -->
          <div class="form-group consent-group">
            <label class="consent-label">
              <input
                type="checkbox"
                formControlName="legalConsent"
                class="consent-checkbox"
              />
              <span class="consent-text">
                Declaro ser o <strong>propriet√°rio legal</strong> ou
                <strong>representante autorizado</strong> desta empresa e compreendo
                que a remo√ß√£o implicar√° na <strong>perda de visibilidade online</strong>.
              </span>
            </label>
            <p class="error-message" *ngIf="isFieldInvalid('legalConsent')">
              Voc√™ deve aceitar esta declara√ß√£o para prosseguir
            </p>
          </div>

          <!-- Mensagem de Erro Global -->
          <div class="error-alert" *ngIf="errorMessage()">
            <span class="icon">‚ö†Ô∏è</span>
            <p>{{ errorMessage() }}</p>
          </div>

          <!-- Bot√µes -->
          <div class="form-actions">
            <button
              type="submit"
              class="btn-submit"
              [disabled]="isSubmitting() || !selectedVendor()">
              <span *ngIf="!isSubmitting()">Enviar Solicita√ß√£o</span>
              <span *ngIf="isSubmitting()">
                <span class="spinner">üîÑ</span>
                Enviando...
              </span>
            </button>
            <a routerLink="/" class="btn-cancel">Cancelar</a>
          </div>
        </form>
      </section>

      <!-- INFO ADICIONAL -->
      <section class="info-section">
        <div class="info-card">
          <h3>üìã Como funciona o processo?</h3>
          <ol class="info-list">
            <li>
              <strong>Valida√ß√£o de Identidade:</strong> Nossa equipe verificar√° se o
              e-mail fornecido corresponde ao propriet√°rio do perfil.
            </li>
            <li>
              <strong>An√°lise (at√© 72h):</strong> Verificamos a legitimidade da
              solicita√ß√£o e poss√≠veis pend√™ncias.
            </li>
            <li>
              <strong>Confirma√ß√£o:</strong> Voc√™ receber√° um e-mail confirmando a
              remo√ß√£o ou solicitando documenta√ß√£o adicional.
            </li>
            <li>
              <strong>Remo√ß√£o:</strong> O perfil ser√° desativado permanentemente da
              plataforma.
            </li>
          </ol>
        </div>

        <div class="info-card">
          <h3>üîê Pol√≠tica de Privacidade</h3>
          <p>
            Respeitamos sua privacidade. Todos os dados fornecidos neste formul√°rio
            s√£o utilizados exclusivamente para valida√ß√£o da titularidade da conta e
            processamento da solicita√ß√£o de remo√ß√£o.
          </p>
          <p>
            <a routerLink="/politica-privacidade" class="link">
              Leia nossa Pol√≠tica de Privacidade completa
            </a>
          </p>
        </div>
      </section>
    </div>
  </div>
</div>
