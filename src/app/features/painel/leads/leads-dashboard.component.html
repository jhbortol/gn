<div class="leads-dashboard">
  <!-- ============================================
       HEADER
       ============================================ -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>
        <span class="icon">ğŸ“§</span>
        Leads Recebidos
      </h1>
      <p class="subtitle">Gerencie todos os contatos recebidos pelo seu perfil</p>
    </div>
    <button class="btn-refresh" (click)="loadLeads()" [disabled]="isLoading()">
      <span class="icon">ğŸ”„</span>
      Atualizar
    </button>
  </header>

  <!-- ============================================
       CARDS DE ESTATÃSTICAS
       ============================================ -->
  <section class="stats-section" *ngIf="leadsData()">
    <div class="stats-grid">
      <!-- Card: Total de Leads -->
      <div class="stat-card stat-total">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
          <p class="stat-label">Total de Leads</p>
          <p class="stat-value">{{ leadsData()!.totalLeads }}</p>
          <p class="stat-detail">Todos os contatos recebidos</p>
        </div>
      </div>

      <!-- Card: NÃ£o Lidos -->
      <div class="stat-card stat-unread">
        <div class="stat-icon">ğŸ””</div>
        <div class="stat-content">
          <p class="stat-label">NÃ£o Lidos</p>
          <p class="stat-value">{{ unreadCount() }}</p>
          <p class="stat-detail">Aguardando sua atenÃ§Ã£o</p>
        </div>
      </div>

      <!-- Card: Este MÃªs -->
      <div class="stat-card stat-month">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-content">
          <p class="stat-label">Este MÃªs</p>
          <p class="stat-value">{{ leadsData()!.leadCountThisMonth }}</p>
          <p class="stat-detail">
            <span *ngIf="!isPlanVitrine()">
              {{ leadsAvailable() }} disponÃ­vel{{ leadsAvailable() !== 1 ? 's' : '' }}
            </span>
            <span *ngIf="isPlanVitrine()">Plano Vitrine - Ilimitado</span>
          </p>
        </div>
      </div>

      <!-- Card: Progresso da Cota (apenas Free tier) -->
      <div class="stat-card stat-quota" *ngIf="!isPlanVitrine()">
        <div class="stat-icon">ğŸ“ˆ</div>
        <div class="stat-content">
          <p class="stat-label">Cota do MÃªs</p>
          <div class="quota-container">
            <div class="quota-bar-wrapper">
              <div [ngClass]="getQuotaProgressClass()"
                [style.width.%]="(leadsData()!.leadCountThisMonth / leadsData()!.leadLimit) * 100">
              </div>
            </div>
            <p class="stat-detail">
              {{ leadsData()!.leadCountThisMonth }} / {{ leadsData()!.leadLimit }} leads
            </p>
          </div>
        </div>
      </div>

      <!-- Card: Status de Leitura -->
      <div class="stat-card stat-reading">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <p class="stat-label">Status de Leitura</p>
          <p class="stat-value">{{ readPercentage() }}%</p>
          <p class="stat-detail">Leads lidos</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================
       UPGRADE CTA BANNER (Free Tier Over Limit)
       ============================================ -->
  <section class="upgrade-banner" *ngIf="isPlanFree() && isOverLimit()">
    <div class="upgrade-content">
      <div class="upgrade-icon">ğŸ”’</div>
      <div class="upgrade-text">
        <h3>PerÃ­odo de degustaÃ§Ã£o encerrado</h3>
        <p>
          VocÃª tem <strong>{{ (leadsData()!.totalLeadsAllTime || leadsData()!.totalLeads) - leadsData()!.leadLimit
            }}</strong>
          {{ ((leadsData()!.totalLeadsAllTime || leadsData()!.totalLeads) - leadsData()!.leadLimit) === 1 ? 'cliente
          esperando' : 'clientes esperando' }}.
          Os dados de contato estÃ£o bloqueados.
        </p>
      </div>
      <button class="btn-upgrade" (click)="upgradeToVitrine()">
        ğŸš€ Desbloquear Agora
      </button>
    </div>
  </section>

  <!-- Free Tier Lead Count -->
  <div class="free-tier-notice" *ngIf="isPlanFree() && !isOverLimit()">
    <p class="text-sm text-gray-600">
      Leads recebidos: <strong>{{ (leadsData()!.totalLeadsAllTime || leadsData()!.totalLeads) }}</strong> de <strong>{{
        leadsData()!.leadLimit }}</strong>
      <span class="text-orange-600 font-semibold ml-2">
        (Restam {{ leadsData()!.leadLimit - (leadsData()!.totalLeadsAllTime || leadsData()!.totalLeads) }} leads
        gratuitos)
      </span>
    </p>
  </div>

  <!-- ============================================
       FILTROS
       ============================================ -->
  <section class="filters-section">
    <div class="filter-group">
      <label>Filtrar por:</label>
      <div class="filter-buttons">
        <button class="filter-btn" [class.active]="statusFilter() === 'todos'" (click)="setStatusFilter('todos')">
          <span class="icon">ğŸ“‚</span>
          Todos ({{ leadsData()?.leads?.length || 0 }})
        </button>
        <button class="filter-btn" [class.active]="statusFilter() === 'nao_lidos'"
          (click)="setStatusFilter('nao_lidos')">
          <span class="icon">ğŸ”´</span>
          NÃ£o Lidos ({{ leadsData()?.unreadLeads ?? 0 }})
        </button>
        <button class="filter-btn" [class.active]="statusFilter() === 'lidos'" (click)="setStatusFilter('lidos')">
          <span class="icon">âœ…</span>
          Lidos ({{ (leadsData()?.totalLeads ?? 0) - (leadsData()?.unreadLeads ?? 0) }})
        </button>
      </div>
    </div>
  </section>

  <!-- ============================================
       MENSAGEM DE ERRO
       ============================================ -->
  <div class="error-alert" *ngIf="errorMessage()">
    <span class="icon">âš ï¸</span>
    <p>{{ errorMessage() }}</p>
    <button class="btn-close" (click)="errorMessage.set('')">Ã—</button>
  </div>

  <!-- ============================================
       ESTADO VAZIO
       ============================================ -->
  <div class="empty-state" *ngIf="!isLoading() && !errorMessage() && leadsData() && leadsData()!.leads.length === 0">
    <div class="empty-icon">ğŸ“­</div>
    <h3>Nenhum lead recebido ainda</h3>
    <p>Quando vocÃª receber contatos, eles aparecerÃ£o aqui</p>
    <p class="empty-tip">ğŸ’¡ Dica: Certifique-se de que seu perfil estÃ¡ ativo e visÃ­vel no Guia Noivas</p>
  </div>

  <!-- ============================================
       TABELA DE LEADS
       ============================================ -->
  <section class="leads-table-section" *ngIf="!isLoading() && paginatedLeads().length > 0">
    <div class="table-responsive">
      <table class="leads-table">
        <thead>
          <tr>
            <th class="col-status">Status</th>
            <th class="col-nome">Nome</th>
            <th class="col-email">Email</th>
            <th class="col-telefone">Telefone</th>
            <th class="col-data">Data</th>
            <th class="col-acoes">AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let lead of paginatedLeads(); let i = index" class="lead-row" [class.unread]="!lead.isRead"
            [class.blurred-row]="shouldBlurLead(lead, i)" (click)="selectLead(lead)">
            <td class="col-status">
              <span [ngClass]="getReadBadgeClass(lead.isRead)">
                {{ getReadStatusText(lead.isRead) }}
              </span>
            </td>
            <td class="col-nome">
              <strong *ngIf="!shouldBlurLead(lead, i)">{{ lead.clienteName }}</strong>
              <span *ngIf="shouldBlurLead(lead, i)" class="blurred-text">{{ getBlurredData('name') }}</span>
            </td>
            <td class="col-email">
              <span *ngIf="!shouldBlurLead(lead, i)" class="email-text">{{ lead.clienteEmail }}</span>
              <span *ngIf="shouldBlurLead(lead, i)" class="blurred-text">{{ getBlurredData('email') }}</span>
            </td>
            <td class="col-telefone">
              <span *ngIf="!shouldBlurLead(lead, i)" class="phone-text">{{ lead.clientePhone }}</span>
              <span *ngIf="shouldBlurLead(lead, i)" class="blurred-text">{{ getBlurredData('phone') }}</span>
            </td>
            <td class="col-data">
              <span class="date-relative" [title]="formatDate(lead.createdAt)">
                {{ formatRelativeTime(lead.createdAt) }}
              </span>
            </td>
            <td class="col-acoes">
              <div class="action-buttons" *ngIf="!shouldBlurLead(lead, i)">
                <button class="btn-action btn-email" title="Enviar email"
                  (click)="openEmailClient(lead.clienteEmail); $event.stopPropagation()">
                  <span>âœ‰ï¸</span>
                </button>
                <button class="btn-action btn-whatsapp" title="Enviar WhatsApp"
                  (click)="openWhatsApp(lead.clientePhone); $event.stopPropagation()">
                  <span>ğŸ’¬</span>
                </button>
                <button class="btn-action btn-copy" title="Copiar email"
                  (click)="copyToClipboard(lead.clienteEmail); $event.stopPropagation()">
                  <span>ğŸ“‹</span>
                </button>
              </div>
              <button *ngIf="shouldBlurLead(lead, i)" class="btn-unlock"
                (click)="upgradeToVitrine(); $event.stopPropagation()">
                ğŸ”“ Desbloquear
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ============================================
         PAGINAÃ‡ÃƒO
         ============================================ -->
    <div class="pagination-section" *ngIf="totalPages() > 1">
      <button class="btn-pagination" (click)="previousPage()" [disabled]="currentPage() === 1">
        â† Anterior
      </button>

      <div class="page-info">
        PÃ¡gina <strong>{{ currentPage() }}</strong> de <strong>{{ totalPages() }}</strong>
      </div>

      <button class="btn-pagination" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
        PrÃ³xima â†’
      </button>
    </div>
  </section>

  <!-- ============================================
       ESTADO DE CARREGAMENTO
       ============================================ -->
  <div class="loading-state" *ngIf="isLoading()">
    <div class="spinner"></div>
    <p>Carregando leads...</p>
  </div>

  <!-- ============================================
       MODAL DE DETALHES DO LEAD
       ============================================ -->
  <div class="modal-overlay" *ngIf="selectedLead()" (click)="closeLeadDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalhes do Lead</h2>
        <button class="btn-close" (click)="closeLeadDetails()">Ã—</button>
      </div>

      <div class="modal-body" *ngIf="selectedLead()">
        <!-- Status -->
        <div class="detail-section">
          <p class="detail-label">Status</p>
          <span [ngClass]="getReadBadgeClass(selectedLead()!.isRead)">
            {{ getReadStatusText(selectedLead()!.isRead) }}
          </span>
        </div>

        <!-- Nome -->
        <div class="detail-section">
          <p class="detail-label">Nome do Cliente</p>
          <p class="detail-value">{{ selectedLead()!.clienteName }}</p>
        </div>

        <!-- Email -->
        <div class="detail-section">
          <p class="detail-label">Email</p>
          <div class="detail-copy">
            <p class="detail-value">{{ selectedLead()!.clienteEmail }}</p>
            <button class="btn-copy-small" (click)="copyToClipboard(selectedLead()!.clienteEmail)">
              ğŸ“‹
            </button>
          </div>
        </div>

        <!-- Telefone -->
        <div class="detail-section">
          <p class="detail-label">Telefone</p>
          <div class="detail-copy">
            <p class="detail-value">{{ selectedLead()!.clientePhone }}</p>
            <button class="btn-copy-small" (click)="copyToClipboard(selectedLead()!.clientePhone)">
              ğŸ“‹
            </button>
          </div>
        </div>

        <!-- Data -->
        <div class="detail-section">
          <p class="detail-label">Data de Recebimento</p>
          <p class="detail-value">{{ formatDate(selectedLead()!.createdAt) }}</p>
        </div>

        <!-- Mensagem -->
        <div class="detail-section">
          <p class="detail-label">Mensagem</p>
          <div class="message-box">{{ selectedLead()!.message }}</div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="openEmailClient(selectedLead()!.clienteEmail)">
          âœ‰ï¸ Enviar Email
        </button>
        <button class="btn btn-primary" (click)="openWhatsApp(selectedLead()!.clientePhone)">
          ğŸ’¬ Enviar WhatsApp
        </button>
        <button class="btn btn-secondary" (click)="closeLeadDetails()">
          Fechar
        </button>
      </div>
    </div>
  </div>
</div>