<div class="imagens-page">
  <div class="page-header">
    <h1>Galeria de Imagens</h1>
    <p class="subtitle">Gerencie as imagens do seu perfil. Arraste para reordenar.</p>
  </div>

  <!-- Alerts -->
  @if (error()) {
    <div class="alert alert-error">
      <span>{{ error() }}</span>
      <button class="close-btn" (click)="error.set(null)">&times;</button>
    </div>
  }

  @if (successMessage()) {
    <div class="alert alert-success">
      <span>{{ successMessage() }}</span>
      <button class="close-btn" (click)="successMessage.set(null)">&times;</button>
    </div>
  }

  <!-- Upload Section -->
  <div class="upload-section">
    <button 
      class="upload-btn" 
      (click)="triggerFileInput()"
      [disabled]="isUploading() || images().length >= 10">
      <span class="icon">ğŸ“¤</span>
      <span>{{ isUploading() ? 'Enviando...' : 'Enviar Imagens' }}</span>
    </button>
    
    <input 
      type="file" 
      id="fileInput"
      multiple
      accept="image/jpeg,image/jpg,image/png,image/webp"
      (change)="onFileSelected($event)"
      style="display: none;">

    <div class="upload-info">
      <p>âœ“ MÃ¡ximo 10 imagens ({{ images().length }}/10)</p>
      <p>âœ“ Formatos: JPEG, PNG, WEBP</p>
      <p>âœ“ Tamanho mÃ¡ximo: 5MB por imagem</p>
    </div>

    @if (isUploading() && uploadProgress() > 0) {
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="uploadProgress()"></div>
      </div>
      <p class="progress-text">{{ uploadProgress() }}%</p>
    }
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Carregando imagens...</p>
    </div>
  }

  <!-- Images Grid with Drag & Drop -->
  @if (!isLoading() && images().length > 0) {
    <div class="images-grid-container">
      <p class="drag-hint">ğŸ’¡ Arraste as imagens para reordenar</p>
      
      <div 
        class="images-grid" 
        cdkDropList
        [cdkDropListAutoScrollDisabled]="false"
        (cdkDropListDropped)="drop($event)">
        
        @for (image of images(); track image.id; let i = $index) {
          <div class="image-card" cdkDrag>
            <div class="image-placeholder" *cdkDragPlaceholder>
              <p>â¬‡ï¸ Soltar aqui â¬‡ï¸</p>
            </div>
            
            <div class="drag-handle" cdkDragHandle>
              <span class="drag-icon">â‹®â‹®</span>
            </div>

            <div class="image-order-badge">
              #{{ i + 1 }}
            </div>

            @if (image.isPrimary) {
              <div class="primary-badge">â­ Principal</div>
            }

            <img 
              [src]="image.url" 
              [alt]="image.filename"
              class="image-preview">

            <div class="image-info">
              <div class="image-filename">{{ image.filename }}</div>
              <div class="image-actions">
                @if (!image.isPrimary) {
                  <button 
                    class="action-btn primary-btn"
                    (click)="setPrimary(image.id)"
                    title="Definir como principal">
                    â­ Principal
                  </button>
                }

                <button 
                  class="action-btn delete-btn"
                  (click)="deleteImage(image.id)"
                  title="Excluir imagem">
                  ğŸ—‘ï¸ Excluir
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && images().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">ğŸ–¼ï¸</div>
      <h3>Nenhuma imagem cadastrada</h3>
      <p>Adicione imagens para mostrar seu trabalho aos noivos.</p>
      <button class="upload-btn-large" (click)="triggerFileInput()">
        Enviar Primeira Imagem
      </button>
    </div>
  }
</div>
